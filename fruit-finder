local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer

local Window = Rayfield:CreateWindow({
   Name = "Monarch Finder",
   LoadingTitle = "Wait....",
   LoadingSubtitle = "Auto Find & Monitor",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "LusiGPT_Monarch",
      FileName = "FruitMonitor"
   }
})

local Tab = Window:CreateTab("Fruit", 4483362458) 
local Section = Tab:CreateSection("Fruit Monitor & Auto Farm")

-- Variable Control
getgenv().AutoFarmFruit = false

-- Fungsi Notifikasi Pojok Bawah (System Tray Style)
local function SystemNotify(title, text)
    StarterGui:SetCore("SendNotification", {
        Title = title;
        Text = text;
        Duration = 5;
    })
end

-- Listener: Mendeteksi Buah Baru (Spawn/Drop) secara Real-time
Workspace.ChildAdded:Connect(function(child)
    if not getgenv().AutoFarmFruit then return end -- Hanya aktif jika toggle nyala

    -- Tunggu sebentar untuk memastikan properti object ter-load
    task.wait(0.5) 
    
    if child:IsA("Tool") or child:IsA("Model") then
        if string.find(child.Name, "Fruit") or string.find(child.Name, "fruit") then
            
            -- Logika Pembeda Drop vs Spawn
            -- Biasanya Spawn alami namanya generik atau muncul di folder tertentu, 
            -- sedangkan Drop pemain seringkali mempertahankan nama toolnya.
            
            local isSpawn = false
            
            -- Cek sederhana: Jika muncul jauh dari player lain, kemungkinan spawn.
            -- Namun sesuai titah, kita buat logikanya berdasarkan nama/kondisi.
            
            if child:FindFirstChild("Handle") then
                -- Jika ada Handle, kita cek apakah itu drop pemain
                SystemNotify("Fruit Detected!", "Drop: " .. child.Name)
            else
                -- Jika struktur modelnya berbeda (biasanya spawn alami di bawah pohon)
                -- Kita beri notif generik sesuai perintah Yang Mulia
                isSpawn = true
                SystemNotify("Alert!", "A Fruit Has Spawned in the World!")
            end
            
            -- Eksekusi Teleportasi Kilat
            if child:FindFirstChild("Handle") then
                LocalPlayer.Character.HumanoidRootPart.CFrame = child.Handle.CFrame
            elseif child:FindFirstChild("Fruit") then -- Kadang model spawn beda
                 LocalPlayer.Character.HumanoidRootPart.CFrame = child.Fruit.CFrame
            end
            
            -- Auto Pickup (Fire Proximity Prompt jika ada)
            local prompt = child:FindFirstChildWhichIsA("ProximityPrompt", true)
            if prompt then
                fireproximityprompt(prompt)
            end
        end
    end
end)

Tab:CreateToggle({
   Name = "Aktifkan Monitor & Auto Teleport",
   CurrentValue = false,
   Flag = "AutoFruitGod", 
   Callback = function(Value)
       getgenv().AutoFarmFruit = Value
       
       if Value then
           Rayfield:Notify({
               Title = "Sistem Aktif",
               Content = "Memantau setiap pergerakan buah untuk Yang Mulia.",
               Duration = 3,
               Image = 4483362458,
           })
           
           -- Cek Loop (Backup jika listener gagal mendeteksi yang sudah ada)
           task.spawn(function()
                while getgenv().AutoFarmFruit do
                    task.wait(1)
                    for _, v in pairs(Workspace:GetChildren()) do
                        if string.find(v.Name, "Fruit") or string.find(v.Name, "fruit") then
                            if v:IsA("Tool") or v:IsA("Model") then
                                local handle = v:FindFirstChild("Handle")
                                if handle then
                                    LocalPlayer.Character.HumanoidRootPart.CFrame = handle.CFrame
                                    if v:FindFirstChild("ProximityPrompt", true) then
                                        fireproximityprompt(v:FindFirstChild("ProximityPrompt", true))
                                    end
                                end
                            end
                        end
                    end
                end
           end)
           
       else
           Rayfield:Notify({
               Title = "Sistem Istirahat",
               Content = "Menunggu perintah selanjutnya, Yang Mulia.",
               Duration = 3,
               Image = 4483362458,
           })
       end
   end,
})
